---
title: "UIkit Basic 6 (GCD, DispatchSourceTimer, UIViewAnimation)"
excerpt: "UIkit Basic"

categories:
  - uikit

toc: true
toc_sticky: true
---

## ğŸ”· DispatchSourceTimer

- Timer: íŠ¹ì •ì‹œê°„ì´ ì§€ë‚œ í›„ì—, event ë¥¼ ë°œìƒ ì‹œí‚¨ë‹¤ê±°ë‚˜, ë°˜ë³µì ì¸ ì£¼ê¸°ë¡œ íŠ¹ì •ì‘ì—…ì„ ìˆ˜í–‰í•˜ë° ì‚¬ìš©í•  ìˆ˜ ìˆìŒë‹ˆë‹¤

- GCD(Grand Central Dispatch) : ì‘ì—…ì„ ë³‘ë ¬ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ apple ì´ ì¬ê³µí•˜ëŠ” API ì…ë‹ˆë‹¤. thread ë¥¼ ë§Œë“¤ê±°ë‚˜, ê´€ë¦¬í•´ì•¼ë˜ëŠ” ì‘ì—…ë“¤ì„ ë³´ë‹¤ ì‰½ê²Œ ì œì–´ í•´ì¤ë‹ˆë‹¤. GCD ë¥¼ ì´ìš©í•˜ë©´ ë§Œë“¤ì–´ì§„ pool ì— task ë“¤ì´ ë‹´ê²¨ ìˆëŠ” queue ì„ ë§Œë“¤ê³ , ê·¸ queue ë¥¼ GCD ì— ë³´ë‚´ë©´, GCD ê°€ ëª¨ë“  thread ë¥¼ ê´€ë¦¬í•´ ì¤ë‹ˆë‹¤

> For more detail GCD in apple devDocs - https://developer.apple.com/documentation/DISPATCH

### ì˜ˆì œ ì½”ë“œ

```swift
// in ViewController.swift

// timer ë¥¼ ì„¤ì •í•˜ê³ , timer ê°€ ì‹œì‘ë˜ëŠ” method
func startTimer() {
	// timer ê°€ nil ì¼ë•Œ makeTimerSource ìƒì„± : flags ì— ë¹ˆë°°ì—´ ë„˜ê²¨ì£¼ê³ , queue parameter ì—ëŠ” ì–´ë–¤ thread queue ì—ì„œ ë°˜ë³µë™ì‘í• ê±´ì§€ ì„¤ì •í•´ì£¼ëŠ” ê²ƒ(timer ê°€ ëŒë•Œë§ˆë‹¤, UI ì‘ì—…ì„ í•´ì¤˜ì•¼ í•¨. ì˜ˆë¥¼ ë“¤ì–´ ë‚¨ì€ ì‹œê°„ì„ í‘œì‹œí•  ìˆ˜ ìˆê²Œ update í•´ì¤˜ì•¼ í•˜ë©°, pregressView ë„ update í•´ì¤˜ì•¼ í•¨ => .main thread ì—ì„œ ë°˜ë³µ ë™ì‘ í•˜ê²Œë” ì„¤ì •í•¨
	// GCD ì—ì„œ main thread ëŠ” app ì „ì²´ì—ì„œ ì˜¤ì§ í•œê°œë§Œ ì¡´ì¬í•¨, ê·¸ë˜ì„œ ì¼ë°˜ì ì¸ code ëŠ” main thread ì—ì„œ ì‹¤í–‰ë˜ëŠ”ë°, ì‘ì„±ëœ code ëŠ” cocoaì—ì„œ ì‹¤í–‰ë˜ëŠ”ë°, cocoa ëŠ” ë§¤ë²ˆ main thread ë¥¼ í˜¸ì¶œí•´ì„œ ì‘ì—…ì„ ì²˜ë¦¬í•˜ëŠ” logic ì´ ìˆìŒ
	// main thread ì—ì„œ ì¤‘ìš”í•œ ì ì€, intefaced thread ë¼ê³  ë¶ˆë¦¬ëŠ”ë°, user ê°€ interface ì— ì ‘ê·¼í•˜ë©´, event ë¥¼ main thread ì— ì „ë‹¬ ë˜ë©°, ì‘ì„±í•œ code ê°€ ê±°ê¸°ì— ë°˜ì‘í•˜ê²Œ ë¨. ì¦‰, interface ì™€ ê´€ë ¨ëœ code ëŠ” ë°˜ë“œì‹œ, main thread ì—ì„œ ì‘ì„±ë˜ì–´ì•¼ í•¨ì„ ì˜ë¯¸ í•©ë‹ˆë‹¤(UIì™€ ê´€ë ¨ëœ ì‘ì—…ì€ main thread ì—ì„œ ì´ë¤„ì ¸ì•¼í•¨)
	if self.timer == nil {
		self.timer = DispatchSource.makeTimerSource(flags: [], queue: .main)
		// schedule: ì–´ë– í•œ ì£¼ê¸°ë¡œ timer ê°€ ì‹¤í–‰ë˜ëŠ”ì§€ ì„¤ì •í•´ì¤˜ì•¼ í•¨ deadline: .now ëŠ” timer ê°€ ì‹œì‘ë˜ë©´ ì¦‰ì‹œ ì‹¤í–‰ë˜ê²Œ í•¨ (ì˜ˆë¡œ 3ì´ˆë’¤ì— ì‹¤í–‰ë˜ì•¼ í•˜ë©´ .now() + 3 í•´ì£¼ë©´ ë¨). repating ì€ ëª‡ì´ˆë§ˆë‹¤ ë°˜ë³µí• ê±´ì§€ ì„¤ì •í•˜ëŠ”ê²ƒ 1ì´ˆë§ˆë‹¤ ë°˜ë³µ ì„¤ì •
		self.timer?.schedule(deadline: .now(), repeating: 1)
		// setEventHandler: timer ì™€ í•¨ê»˜ ì—°ë™ëœ eventHandler í• ë‹¹ => í´ë¡œì ¸ í•¨ìˆ˜ë¡œ timer ê°€ ë™ì‘í• ë•Œ ë§ˆë‹¤, handler closure í•¨ìˆ˜ê°€ í˜¸ì¶œì´ ë¨( ì—¬ê¸°ì„  1ì´ˆì— í•œë²ˆì”© handler ì— êµ¬í˜„ë˜ëŠ” code ê°€ ì‹¤í–‰ë˜ê²Œ ë¨)
		self.timer?.setEventHandler(handler: { [weak self] in
			// ì¼ì‹œì ìœ¼ë¡œ self ê°€ strong reference ê°€ ë˜ê²Œ í•¨
			guard let self = self else { return }
			self.currentSeconds -= 1 // ì´ˆë‹¹ 1ì”© ê°ì†Œí•˜ê²Œ í•¨
			// ì´ˆë¥¼ ì‹œ,ë¶„,ì´ˆë¡œ ë³€í™˜í•˜ê¸°
			let hour = self.currentSeconds / 3600 // ì´ˆë¥¼ 3600 ìœ¼ë¡œ ë‚˜ëˆ„ë©´ ì‹œê°„
			let minutes = (self.currentSeconds % 3600) / 60 // ë¶„ì€ 3600ìœ¼ë¡œ ë‚˜ëˆˆ ë‚˜ë¨¸ì§€ì—ì„œ 60 ë‚˜ëˆ„ê¸°
			let seconds = (self.currentSeconds % 3600) % 60 // ì´ˆëŠ” 3600ìœ¼ë¡œ ë‚˜ëˆˆ ë‚˜ë¨¸ì§€ì— 60ì˜ ë‚˜ë¨¸ì§€ ê°’
			// String í¬ë©§ í˜•ì‹ìœ¼ë¡œ 2ìë¦¬ ìˆ«ìì— : ìœ¼ë¡œ êµ¬ë¶„ëœ í˜•ì‹ìœ¼ë¡œ í•˜ê³ , arguments ì—ëŠ” hour, minutes, seconds í• ë‹¹
			self.timerLabel.text = String(format: "%02d:%02d:%02d", hour, minutes, seconds)
			// debugPrint(self.currentSeconds)

			// ì‹œê°„ì— ë§ì¶°ì„œ progressBar ë„ ì¤„ì–´ë“œëŠ” logic: countDown ë˜ê³  ìˆëŠ” ì‹œê°„ì„ datePicker ì—ì„œ ì„¤ì •í•œ ì´ ì‹œê°„ì„ ë‚˜ëˆ  ì£¼ë©´ countDown ë  ë•Œë§ˆë‹¤ progress ê²Œì´ì§€ê°€ ì¤„ì–´ ë“¤ê²Œ ë¨(progress ëŠ” Float type ìœ¼ë¡œ ë³€í™˜ ì‹œì¼œì•¼ í•¨)
			self.pregressView.progress = Float(self.currentSeconds) / Float(self.duration)
			debugPrint(self.pregressView.progress)

			// currentSeconds ê°€ 0ë³´ë‹¤ ì‘ê±°ë‚˜, ê°™ë‹¤ë©´ countDown ì´ ëë‚œê²ƒì´ê¸° ë•Œë¬¸ì—
			if self.currentSeconds <= 0 {
				// timer ì¢…ë£Œ code
				self.stopTimer() // timer ì¢…ë£Œ
			}
		})
		// hander closure ê°€ ì™„ë£Œ ë˜ë©´ timer ê°€ ì‹œì‘ë˜ê²Œ í•¨
		self.timer?.resume()
	}
}

// timer ê°€ 0ë³´ë‹¤ ê°™ê±°ë‚˜ ì‘ì„ë•Œ ì™€ cancelBtn ì„ ëˆ„ë¥´ë©´ timer ê°€ ì¢…ë£Œë˜ëŠ” method
func stopTimer() {
	// .pause ìƒíƒœ ì¼ê²½ìš°ì— resume method ìƒì„±ë˜ê²Œ ì‘ì„±
	if self.timerStatus == .pause {
		self.timer?.resume()
	}
	self.timerStatus = .end
	self.cancelBtn.isEnabled = false
	self.setTimerInfoViewVisable(isHidden: true)
	self.datePicker.isHidden = false
	self.toggleBtn.isSelected = false
	self.timer?.cancel() // timer ì¢…ë£Œ
	self.timer = nil // timer ë©”ëª¨ë¦¬ì—ì„œ í•´ì¬ ì‹œí‚´: í•´ì¬ ì•ˆì‹œí‚¤ë©´ í™”ë©´ì„ ë²—ì–´ë‚˜ë„, timer ê°€ ê³„ì† ë™ì‘ í•  ìˆ˜ ìˆìŒ
}
```

## ğŸ”· UIViewAnimation

### í™”ë©´ì˜ transition íš¨ê³¼ ì ìš©í•˜ê¸° (alpha ê°’ ì¡°ì ˆ)

- Viewì˜ ì—¬ë¶€ë¥¼ isHidden ê°’ì´ ì•„ë‹Œ, alpha ê°’ìœ¼ë¡œ ì„¤ì •í•´ì„œ View ê°€ ì‚¬ë¼ì§€ê³  í‘œì‹œë˜ê²Œ ë§Œë“­ë‹ˆë‹¤. alpha ê°’ì€ opacity ê°’ì„ ì¡°ì ˆí•˜ëŠ” ì¸ì ì…ë‹ˆë‹¤. ìµœì†Œ 0 ~ 1ê¹Œì§€ ì„¤ì •í•˜ëŠ”ë° 0 ì— ê°€ê¹Œìš¸ìˆ˜ë¡ view ê°€ íˆ¬ëª…í•´ ì§‘ë‹ˆë‹¤.

```swift

func stopTimer() {
	// .pause ìƒíƒœ ì¼ê²½ìš°ì— resume method ìƒì„±ë˜ê²Œ ì‘ì„±
	if self.timerStatus == .pause {
		self.timer?.resume()
	}
	self.timerStatus = .end
	self.cancelBtn.isEnabled = false
	// alpha ê°’ ì¡°ì ˆì„ í†µí•œ animation
	UIView.animate(withDuration: 0.5, animations: {
		self.timerLabel.alpha = 0
		self.pregressView.alpha = 0
		self.datePicker.alpha = 1
	})

@IBAction func tabCancelBtn(_ sender: UIButton) {
	switch self.timerStatus {
		// start, paue ìƒíƒœì—ì„œ cancelBtn ëˆ„ë¥´ë©´ .end ìƒíƒœë¡œ ë†“ê³ , cancelBtn ì„ ë¹„í™œì„±í™”ë¡œ í•˜ê³ , timerLabelê³¼ pregressView ê°€ í‘œì‹œë˜ì§€ ì•Šê²Œí•¨, datePicker ê°€ ë‹¤ì‹œ í‘œì‹œë˜ê²Œ í•¨, toggleBtnì´ strart ë˜ê²Œ í•¨
	case .start, .pause:
		switch self.timerStatus {
			// end ì¼ê²½ìš° ì•„ì§ ì‹œì‘ ì•ˆí•œìƒíƒœ timer label ê³¼ progressView ê°€ í‘œì‹œë˜ê²Œ í•˜ê³ , datePicker ê°€ hidden ë˜ê²Œ í•¨
	case .end:
		self.currentSeconds = self.duration // í˜„ì¬ ì‹œê°„ì„ duration ì— ëŒ€ì… ì‹œí‚´
		self.timerStatus = .start
		// alpha ê°’ ì¡°ì ˆì„ í†µí•œ animation
		UIView.animate(withDuration: 0.5, animations: {
			self.timerLabel.alpha = 1
			self.pregressView.alpha = 1
			self.datePicker.alpha = 0
		})
```

![Kapture 2021-12-17 at 14 01 52](https://user-images.githubusercontent.com/28912774/146491720-a7d35e0f-7796-41c8-881a-29687cce3557.gif)

### ê³ ì •ë˜ì–´ ìˆëŠ” image ì˜ íšŒì „ íš¨ê³¼ animation

```swift
	// image rotation animation
	UIView.animate(withDuration: 0.5, delay: 0, animations: {
		// CGAffineTransform ì€ êµ¬ì¡°ì²´ ì¸ë°, view ì˜ frame ì„ ê³„ì‚°í•˜ì§€ ì•Šê³  2D ê·¸ë˜í”½ì„ ê·¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ì˜ˆë¥¼ ë“¤ì–´ Viewë¥¼ ì´ë™ ì‹œí‚¤ê±°ë‚˜, íšŒì „ì‹œí‚¤ëŠ” íš¨ê³¼ë¥¼ ì¤„ìˆ˜ ìˆìŠµë‹ˆë‹¤. rotationAngle: .pi ì€ 180ë„ íšŒì „ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.
		self.imageView.transform = CGAffineTransform(rotationAngle: .pi)
	})
	// ë‹¤ì‹œ 360ë„ íšŒì „ ì‹œí‚´ : ìœ„ì— 180 ë„ íšŒì „ animation ì´ ëë‚˜ë©´ ë™ì‘ í•  ìˆ˜ ìˆê²Œ delay 0.5 ì„¤ì •
	UIView.animate(withDuration: 0.5, delay: 0.5, animations: {
		self.imageView.transform = CGAffineTransform(rotationAngle: .pi * 2)
	})

	self.imageView.transform = .identity // cancel ë˜ë©´ imageView ê°€ ì›ìƒíƒœë¡œ ë˜ê²Œ í•¨
```

![Kapture 2021-12-17 at 14 03 38](https://user-images.githubusercontent.com/28912774/146491833-56ba41f5-5cdc-4fa5-9652-9d604fe4dbb5.gif)

---

ğŸ”¶ ğŸ”· ğŸ“Œ ğŸ”‘ ğŸ‘‰

## ğŸ—ƒ Reference

diary-ios-practice code - [https://github.com/jacobkosmart/timer-ios-practice.git](https://github.com/jacobkosmart/timer-ios-practice.git)

ì¬:í¸ì§‘ ê°œë°œë¸”ë¡œê·¸ - [https://dev-dream-world.tistory.com/133](https://dev-dream-world.tistory.com/133)

fastcampus - [https://fastcampus.co.kr/dev_online_iosappfinal](https://fastcampus.co.kr/dev_online_iosappfinal)
