---
title: "2.Authentication"
excerpt: "firebase"

categories:
  - firebase

toc: true
toc_sticky: true
---

---

## 1.Firebase Auth

> [firebase Auth Docs](https://firebase.google.com/docs/reference/js/firebase.auth.Auth)

- firebase auth ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ project ì— ë¨¼ì € import í•´ì¤˜ì•¼ í•¨

```js
// in firebase.js

// Firebase App (the core Firebase SDK) is always required and must be listed first
import firebase from "firebase/app";
// import firebase/auth
import "firebase/auth";

const firebaseConfig = {
  apiKey: process.env.REACT_APP_API_KEY,
  authDomain: process.env.REACT_APP_AUTH_DOMAIN,
  databaseURL: process.env.REACT_APP_DATABASE_URL,
  projectId: process.env.REACT_APP_PROJECT_ID,
  storageBucket: process.env.REACT_APP_STORAGE_BUCKET,
  messagingSenderId: process.env.REACT_APP_MESSAGIN_ID,
  appId: process.env.REACT_APP_APP_APP_ID,
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);

// authService ë¡œ firebase.auth() í˜¸ì¶œí•˜ëŠ”ê²ƒì„
export const authService = firebase.auth();
```

```js
// in App.js

// {authService} ë¥¼ ë³€ìˆ˜ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë¨
import React, { useState } from "react";
import useTitle from "@jacob-hooks/use-title";
import { authService } from "../fbase";
import AppRouter from "./Router";

function App() {
  useTitle("Chat-app");
  console.log(authService.currentUser);
  // authService.currentUser ë¥¼ í†µí•´ ë¡œê·¸ì¸ ë˜ì—ˆëŠ”ì§€ ì•ˆë˜ì—ˆëŠ”ì§€ í™•ì¸ í•  ìˆ˜ ìˆìŒ (ë¡œê·¸ì¸ ì•ˆë˜ì–´ ìˆìœ¼ë©´ null ì´ return )
  const [isLoggedIn, setIsLoggedIn] = useState(authService.currentUser);
  return (
    <>
      <AppRouter isLoggedIn={isLoggedIn} />
      <footer>&copy; {new Date().getFullYear()} Jacob Ko</footer>
    </>
  );
}

export default App;
```

## 2.Login form

- Authentication ì„ ìœ„í•´ì„œ ê°„ë‹¨í•œ login form ì„ ë§Œë“¬

```js
import React, { useState } from "react";

const Auth = () => {
  // set state email, password
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");

  // onchange to email, password
  const onChange = (e) => {
    const {
      target: { name, value },
    } = e;
    if (name === "email") {
      setEmail(value);
    } else if (name === "password") {
      setPassword(value);
    }
  };

  // ê¸°ë³¸ì ì¸ ì‹¤í–‰ (refresh ëœ ë‹´ì— url ì— value ê°’ ë‚˜ì˜¤ëŠ”ê²ƒ) í•˜ì§€ ì•Šê¸° ìœ„í•´ preventDefault()
  const onSubmit = (e) => {
    e.preventDefault();
  };

  return (
    <>
      <form onSubmit={onSubmit}>
        <input
          name="email"
          type="email"
          placeholder="Email"
          required
          value={email}
          onChange={onChange}
        />
        <input
          name="password"
          type="password"
          placeholder="Password"
          required
          value={password}
          onChange={onChange}
        />
        <input type="submit" value="Log In" />
      </form>
      <div>
        <button>Continue with Google</button>
        <button>Continue with Github</button>
      </div>
    </>
  );
};

export default Auth;
```

## 3.Creating account

> [EmailAuthProvider](https://firebase.google.com/docs/reference/js/firebase.auth.EmailAuthProvider)

- ì´ë©”ì¼ê³¼ íŒ¨ìŠ¤ì›Œë“œë¡œ ì‚¬ìš©ì ê³„ì •ì„ ë§Œë“¤ê¸°

> [createWithEmailAndPassword](https://firebase.google.com/docs/reference/js/firebase.auth.Auth#createuserwithemailandpassword)

```js
// in Auth.js

import React, { useState } from "react";
import { authService } from "../fbase";

const Auth = () => {
  // set state email, password, newAccount
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [newAccount, setNewAccount] = useState(true);

  // onchange to email, password
  const onChange = (e) => {
    const {
      target: { name, value },
    } = e;
    if (name === "email") {
      setEmail(value);
    } else if (name === "password") {
      setPassword(value);
    }
  };

  // ê¸°ë³¸ì ì¸ ì‹¤í–‰ (refresh ëœ ë‹´ì— url ì— value ê°’ ë‚˜ì˜¤ëŠ”ê²ƒ) í•˜ì§€ ì•Šê¸° ìœ„í•´ preventDefault()
  const onSubmit = async (e) => {
    e.preventDefault();
    try {
      let data;
      if (newAccount) {
        // create account
        data = await authService.createUserWithEmailAndPassword(
          email,
          password
        );
      } else {
        // log in
        data = await authService.signInWithEmailAndPassword(email, password);
      }
      console.log(data);
    } catch (error) {
      console.log(error);
    }
  };

  return (
    <>
      <form onSubmit={onSubmit}>
        <input
          name="email"
          type="email"
          placeholder="Email"
          required
          value={email}
          onChange={onChange}
        />
        <input
          name="password"
          type="password"
          placeholder="Password"
          required
          value={password}
          onChange={onChange}
        />
        <input type="submit" value={newAccount ? "Create Account" : "Log In"} />
      </form>
      <div>
        <button>Continue with Google</button>
        <button>Continue with Github</button>
      </div>
    </>
  );
};

export default Auth;
```

## 4.Log In

- setPersistence : ì‚¬ìš©ìë“¤ì„ ì–´ë–»ê²Œ ê¸°ì–µí•  ê²ƒì¸ì§€ ì„ íƒí•  ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ”ê²ƒ

> [setPersistence](https://firebase.google.com/docs/auth/web/auth-state-persistence#supported_types_of_auth_state_persistence)

![image](https://user-images.githubusercontent.com/28912774/129184849-c709d818-a80c-479e-962a-158c52fe1357.png)

`value` ì— ê¸°ë³¸ê°’ì€ `local` ë¡œì¨ ìƒˆë¡œê³ ì¹¨ í•˜ë”ë¼ë„ ì‚¬ìš©ìì˜ ì •ë³´ëŠ” ê³„ì† ì €ì¥ë˜ì„œ ë¡œê·¸ì¸ ìƒíƒœë¥¼ ìœ ì§€ ì‹œì¼œì£¼ëŠ”ê²ƒì„

- App ì´ ë¡œë“œ ë ë•Œ ì‹œê°„ì´ ë¹ ë¥´ê²Œ ì¼ì–´ë‚˜ê¸° ë•Œë¬¸ì—firebaseëŠ” ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ ë˜ì—ˆëŠ”ì§€ ì•„ë‹Œì§€ë¥¼ í™•ì¸í•  ì‹œê°„ì´ ì—†ê²Œ ëœë‹¤ ê·¸ë˜ì„œ refresh í•´ë„ ì—¬ì „íˆ ë¡œê·¸ì¸ ì •ë³´ê°€ ë‚¨ì•„ ìˆê²Œ ë¨

- onAuthStateChanged : ì‚¬ìš©ìì˜ ë¡œê·¸ì¸ ìƒíƒœì˜ ë³€í™”ë¥¼ ê´€ì°°í•˜ëŠ” observer ë¥¼ ì¶”ê°€ì‹œì¼œì„œ ë³€í™”ë¥¼ ì•Œì•„ì°¨ë ¤ì„œ ìœ ì € ìƒíƒœì— ë³€í™”ê°€ ìˆì„ ë•Œ ê·¸ ë³€í™”ë¥¼ ì•Œì•„ì°¨ë¦¬ê²Œ ë˜ëŠ” ê²ƒì„ ìœ ì €ê°€ ì§„ì§œë¡œ ë¡œê·¸ì•„ì›ƒí•  ë•Œë„ ë°œìƒí•˜ê³  ê³„ì •ì´ ìƒì„±í•  ë•Œë„ trigger ë˜ê³  firebase ê°€ ì´ˆê¸°í™” ë ë•Œë„ ì‹¤í–‰ ë¨ ê·¸ë¦¬ê³  ë‚˜ì„œ ë‹¤ìŒì— ë¡œê·¸ì¸ ë˜ëŠ” ìˆœê°„ë„ ì•Œì•„ì°¨ë¦¬ê²Œ ë˜ëŠ”ê²ƒì„

> [onAuthStateChanged](https://firebase.google.com/docs/reference/node/firebase.auth.Auth#onauthstatechanged)

- ê·¸ë˜ì„œ ì‹¤ì œë¡œ ë¡œê·¸ì¸ì´ ë˜ì—ˆëŠ”ì§€ ì•ˆë˜ì—ˆëŠ”ì§€ë¥¼ ì•Œ ìˆ˜ ìˆê²Œ ë¨. ì´ë ‡ê²Œ ë˜ë©´ `authService.currentUser` ì—ì„œëŠ” ì‹¤ì œë¡œ ë¡œê·¸ì¸ëœ ê±´ì§€ ë¡œê·¸ì•„ì›ƒí•œ ê±´ì§€ ì˜ ëª¨ë¥´ê¸° ë•Œë¬¸ì„

```js
// useEffect ì— mount ê°€ ë³€í™”ê°€ ìˆëŠ”ì§€ë¥¼ ë“£ê³  ìˆëŠ” ê²½ìš°ê°€ ë¨. ëˆ„êµ°ê°€ê°€ create account ë¥¼ í´ë¦­í•˜ê±°ë‚˜ ë˜ëŠ” log in ì„ ëˆŒë €ê±°ë‚˜ ì•„ë‹ˆë©´ ì´ë¯¸ ë¡œê·¸ì¸ ë˜ì–´ ìˆì–´ì„œ firebase ëŠ” ìŠ¤ìŠ¤ë¡œ ì´ˆê¸°í™”í•˜ëŠ” ê²ƒì„ ëëƒˆê¸° ë•Œë¬¸ì„
  const [init, setInit] = useState(false);
  const [isLoggedIn, setIsLoggedIn] = useState(false);

  useEffect(() => {
    authService.onAuthStateChanged((user) => {
      if (user) {
        setIsLoggedIn(true);
      } else {
        setIsLoggedIn(false);
      }
      // ë§ˆì§€ë§‰ì— setInit(true) ì„ í•´ì¤˜ì„œ init ì´ false ë¼ë©´ router ë¥¼ ìˆ¨ê¸¸ê²ƒì´ê¸° ë•Œë¬¸ì— true ë¥¼ í•´ì¤Œ
      setInit(true)
    });
```

## 5.Social Login

- signInWithPopup : social ë¡œê·¸ì¸ì„ ìœ„í•œ popup ì°½ ì„¤ì •

> [signInWithPopup](https://firebase.google.com/docs/reference/js/firebase.auth.Auth#signinwithpopup)

```js
// Social login function
const onSocialClick = async (e) => {
  const {
    target: { name },
  } = e;
  let provider;
  if (name === "google") {
    provider = new firebaseInstance.auth.GoogleAuthProvider();
  } else if (name === "github") {
    provider = new firebaseInstance.auth.GithubAuthProvider();
  }
  const data = await authService.signInWithPopup(provider);
  console.log(data);
};

<div>
  <button onClick={onSocialClick} name="google">
    Continue with Google
  </button>
  <button onClick={onSocialClick} name="github">
    Continue with Github
  </button>
</div>;
```

## 6.Log out

- sinOut : ë¡œê·¸ì•„ì›ƒ ìƒíƒœë¡œ ë§Œë“¤ì–´ ì¤Œ

> [singOut](https://firebase.google.com/docs/reference/js/firebase.auth.Auth#signout)

```js
const onLogOutClick = () => authService.signOut();
return (
  <div>
    <button onClick={onLogOutClick}>Log Out</button>
  </div>
);
```

- ê·¼ë° ë§Œì•½ ë¡œê·¸ì•„ì›ƒ ë˜ê³  redirect ë¥¼ ì•ˆí•´ì£¼ë©´ ê·¸ í•´ë‹¹ í˜ì´ì§€ì— ê·¸ëŒ€ë¡œ ë‚¨ì•„ ìˆê¸° ë•Œë¬¸ì— react-router-dom ì˜ redirect ì„ ì‚¬ìš©í•´ì„œ ì´ˆê¸°í™”ë©´ "/" ìœ¼ë¡œ ì´ë™í•˜ê²Œ í•¨

> [react-router-dom Redirect](https://reactrouter.com/web/api/Redirect)

```js
<>
  <Route exact path="/">
    <Home />
  </Route>
  <Route exact path="/profile">
    <Profile />
  </Route>
  <Redirect from="*" to="/" />
</>
```

- redirect ë°©ë²•ë§ê³  router hook ì˜ useHistory ì„ ì‚¬ìš©í•´ì„œ ì´ˆê¸°í™”ë©´ìœ¼ë¡œ ì´ë™ ì‹œì¼œ ì¤„ ìˆ˜ ìˆìŒ

> [usHistory](https://reactrouter.com/web/api/Hooks/usehistory)

```js
const history = useHistory();

const onLogOutClick = () => {
  authService.signOut();
  history.push("/");
};
return (
  <div>
    <button onClick={onLogOutClick}>Log Out</button>
  </div>
);
```

ğŸ”¶ ğŸ”· ğŸ“Œ ğŸ”‘

## Reference

- normad corder hooks - [https://nomadcoders.co/react-hooks-introduction/lobby](https://nomadcoders.co/react-hooks-introduction/lobby){:target="\_blank"}
