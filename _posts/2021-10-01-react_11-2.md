---
title: "11-2.Redux-advanced"
excerpt: "react"

categories:
  - react

toc: true
toc_sticky: true
---

---

## 1.Async action with Redux

container ëŠ” redux ì˜ ë¡œì§ë§Œ ë‹¤ë£¨ê³  (ê·¸ë˜ì„œ ë¹„ë™ê¸° ì‘ì—…ë„ ì—¬ê¸°ì„œ ì‹¤í–‰í•¨)

ì´ ë°©ë²•ì€ redux ì— middleware ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  ë¹„ë™ê¸° í˜¸ì¶œí•˜ëŠ” ë°©ì‹ì„

### actions.js ì—ì„œ users types ì„¤ì •í•¨

```js
// users types

// github API í˜¸ì¶œì„ ì‹œì‘í•˜ëŠ” ê²ƒì„ ì˜ë¯¸í•¨
export const GET_USERS_START = "GET_USERS_START";
// github API í˜¸ì¶œì—ëŒ€í•´ì„œ ì‘ë‹µì´ ì„±ê³µì ìœ¼ë¡œ ëŒì•„ì˜¨ ê²½ìš°ë¥¼ ì˜ë¯¸í•¨
export const GET_USERS_SUCCESS = "GET_USERS_SUCCESS";
// github API í˜¸ì¶œì—ëŒ€í•´ì„œ ì‘ë‹µì´ ì‹¤íŒ¨í•œ ê²½ìš°ë¥¼ ì˜ë¯¸í•¨
export const GET_USERS_FAIL = "GET_USERS_FAIL";

export const getUsersStart = () => {
  return {
    type: GET_USERS_START,
  };
};

export const getUsersSuccess = (data) => {
  return {
    type: GET_USERS_SUCCESS,
    data,
  };
};

export const getUsersFail = (error) => {
  return {
    type: GET_USERS_FAIL,
    error,
  };
};
```

### userListContainer.js ì—ì„œ ë¹„ë™ê¸° ì‘ì„± ì‹¤í–‰

```js
import { useCallback } from "react";
import { useDispatch } from "react-redux";
import { useSelector } from "react-redux";
import UserList from "../components/UserList";
import { getUsersFail, getUsersStart, getUsersSuccess } from "../redux/actions";
import axios from "axios";

const UserListContainer = () => {
  // state ì—ì„œ users.data ë¥¼ ë¶ˆëŸ¬ì˜´
  const users = useSelector((state) => state.users.data);
  // useDispatch ì‚¬ìš©
  const dispatch = useDispatch();

  // ë¹„ë™ê¸° í•¨ìˆ˜ api í˜¸ì¶œ
  const getUsers = useCallback(async () => {
    try {
      // getUsersStart ì•¡ì…˜ ì‹¤í–‰
      dispatch(getUsersStart());
      // API í˜¸ì¶œ
      const res = await axios.get("https://api.github.com/users");
      // í˜¸ì¶œ ì„±ê³µì‹œ response.data ê°€ì ¸ì˜´
      dispatch(getUsersSuccess(res.data));
      // ì—ëŸ¬ ë°œìƒì‹œ dispatch error ì‹¤í–‰
    } catch (error) {
      dispatch(getUsersFail(error));
    }
    // dispatch ë ë•Œë§ˆë‹¤ë§Œ ì ìš© dependency
  }, [dispatch]);

  // UserList ì— users, getUsers props ì „ì†¡í•¨
  return <UserList users={users} getUsers={getUsers} />;
};

export default UserListContainer;
```

```js
// in UserListContainer.jsx

import { useCallback } from "react";
import { useDispatch } from "react-redux";
import { useSelector } from "react-redux";
import UserList from "../components/UserList";
import { getUsersFail, getUsersStart, getUsersSuccess } from "../redux/actions";
import axios from "axios";

const UserListContainer = () => {
  // state ì—ì„œ users.data ë¥¼ ë¶ˆëŸ¬ì˜´
  const users = useSelector((state) => state.users.data);
  // useDispatch ì‚¬ìš©
  const dispatch = useDispatch();

  // ë¹„ë™ê¸° í•¨ìˆ˜ api í˜¸ì¶œ
  const getUsers = useCallback(async () => {
    try {
      // getUsersStart ì•¡ì…˜ ì‹¤í–‰
      dispatch(getUsersStart());
      // API í˜¸ì¶œ
      const res = await axios.get("https://api.github.com/users");
      // í˜¸ì¶œ ì„±ê³µì‹œ response.data ê°€ì ¸ì˜´
      dispatch(getUsersSuccess(res.data));
      // ì—ëŸ¬ ë°œìƒì‹œ dispatch error ì‹¤í–‰
    } catch (error) {
      dispatch(getUsersFail(error));
    }
    // dispatch ë ë•Œë§ˆë‹¤ë§Œ ì ìš© dependency
  }, [dispatch]);

  // UserList ì— users, getUsers props ì „ì†¡í•¨
  return <UserList users={users} getUsers={getUsers} />;
};

export default UserListContainer;
```

### Present component ì¸ userListì— ë°›ì€ props data ë¥¼ ë¿Œë ¤ ì¤ë‹ˆë‹¤

```js
import { useEffect } from "react";

const UserList = ({ users, getUsers }) => {
  useEffect(() => {
    getUsers();
  }, [getUsers]);

  if (users.length === 0) {
    return <p>í˜„ì¬ ìœ ì € ì •ë³´ ì—†ìŒ</p>;
  }
  return (
    <ul>
      {users.map((user) => (
        <li key={user.id}>{user.login}</li>
      ))}
    </ul>
  );
};

export default UserList;
```

## 2.Redux middleware

> [Redux middleware ìì„¸íˆ ë³´ê¸°](https://redux.js.org/understanding/history-and-design/middleware)

- middleware ê°€ **dispatch** ì˜ ì•ë’¤ì— ì½”ë“œë¥¼ ì¶”ê°€í• ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.

- middleware ê°€ ì—¬ëŸ¬ê°œë©´ middleware ê°€ **ìˆœì°¨ì ìœ¼ë¡œ** ì‹¤í–‰ë©ë‹ˆë‹¤.

- ë‘ê°€ì§€ ë‹¨ê³„ê°€ ìˆëŠ”ë°.

  - storeë¥¼ ë§Œë“¤ë•Œ, middlewareë¥¼ ì„±ì •í•˜ëŠ” ë¶€ë¶„ `{createStore, applyMiddleware} from redux`

  - dispatchê°€ í˜¸ì¶œë ë•Œ ì‹¤ì œë¡œ middlewareë¥¼ í†µê³¼í•˜ëŠ” ë¶€ë¶„

- dispatch ë©”ì†Œë“œë¥¼ í†µí•´ storeë¡œ ê°€ê³  ìˆëŠ” ì•¡ì…˜ì„ ê°€ë¡œì±„ëŠ” ì½”ë“œì„

- middleware ëŠ” `createStore()` í•˜ëŠ” ë¶€ë¶„ì—ì„œ ì„¤ì •ë˜ì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì— `store.js` íŒŒì¼ì—ì„œ ì„¤ì •ì„ ì£¼ë¡œ í•´ì¤ë‹ˆë‹¤.

```js
// in store.js

import { applyMiddleware, createStore } from "redux";
import todoApp from "./reducers/reducer";

const middleware1 = (store) => {
  //next ë¼ê³  ë‹¤ìŒ middlewareë¥¼ ì§€ì¹­í•˜ëŠ” í˜•íƒœë¡œ ì‚¬ìš©í•¨
  console.log("middleware1", 0);
  return (next) => {
    console.log("middleware1", 1, next);
    return (action) => {
      console.log("middleware1", 2);
      const returnValue = next(action);
      console.log("middleware1", 3);
      return returnValue;
    };
  };
};

const middleware2 = (store) => {
  //next ë¼ê³  ë‹¤ìŒ middlewareë¥¼ ì§€ì¹­í•˜ëŠ” í˜•íƒœë¡œ ì‚¬ìš©í•¨
  console.log("middleware2", 0);
  return (next) => {
    console.log("middleware2", 1, next);
    return (action) => {
      console.log("middleware2", 2);
      const returnValue = next(action);
      console.log("middleware2", 3);
      return returnValue;
    };
  };
};

// todoApp ë’¤ì—ìˆëŠ” ê²ƒì´ enhancer ì¸ applyMiddleware í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•¨
const store = createStore(todoApp, applyMiddleware(middleware1, middleware2));

export default store;
```

console.log ë¡œ ë³´ê²Œ ë˜ë©´ dispatch ë ë•Œ ë§ˆë‹¤ ìˆœì„œê°€ í™•ì¸í•˜ëŠ”ê²Œ ì¤‘ìš”í•©ë‹ˆë‹¤.

middleware1 2 => middleware2 2 => middleware2 3 => middleware3 3

![image](https://user-images.githubusercontent.com/28912774/135610771-ca11013a-bbfd-432f-b3f8-059dfd29cfee.png)

redux middleware ëŠ” ìœ„ì™€ ê°™ì´ êµ¬í˜„í•˜ëŠ” í•˜ê¸° ìœ„í•´ middleware í”ŒëŸ¬ê·¸ì¸ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

## 3.redux-devtools

middlewareë¥¼ ì„¤ì¹˜í•´ì„œ ë¸Œë¼ìš°ì €ì— ìˆëŠ” devtoolsë¥¼ ì—°ê²°í•˜ëŠ” ì‘ì—…ì„ í•˜ëŠ”ê²ƒì„ redux-devtools ì…ë‹ˆë‹¤.

### ì„¤ì¹˜

```bash
yarn add redux-devtools-extension -D
```

`applyMiddleware` ì˜ ì‹¤í–‰ ê²°ê³¼ë¥¼ `composeWithDevTools`ë¡œ ê°ì‹¸ì„œ ì‹¤í–‰í•´ ì¤ë‹ˆë‹¤. ê·¸ë ‡ê²Œ í•˜ë©´ redux-devtools-extension ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë³´ë‚¼ ì¤€ë¹„ê°€ ëœê²ƒì…ë‹ˆë‹¤.

```js
//  in store.js

const store = createStore(todoApp, composeWithDevTools(applyMiddleware()));
```

> [Redux DevTools Extension Github](https://github.com/zalmoxisus/redux-devtools-extension)

- ì£¼ë¡œ chrome ì„ ì‚¬ìš©í•˜ëŠ”ë° í¬ë¡¬ ì›¹ ìŠ¤í† ì–´ì— Redux DevTools ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/28912774/135613055-afc4238c-29cf-4aa6-b1c0-b6b107029ff9.png)

- ì£¼ë¡œ reduxì— ë¬¸ì œê°€ ìˆì„ ê²½ìš°ì— devTools ë¥¼ ì‚¬ìš©í•´ì„œ ë¬¸ì œ í•´ê²°ì„ í•˜ê²Œ ë©ë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/28912774/135614244-330aaaa9-9836-4a85-bd41-c0e18158d029.png)

## 4.redux-thunk

- redux middleware ì¤‘ì—ì„œ ê°€ì¥ë§ì´ ì‚¬ìš©ë˜ê³  ìˆëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¸ redux-thunk ì…ë‹ˆë‹¤.

> [redux-thunk](https://github.com/reduxjs/redux-thunk)

- reduxë¥¼ ë§Œë“  ì‚¬ëŒì´ ë§Œë“  ë¼ì´ë¸ŒëŸ¬ë¦¬

- reduxì—ì„œ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬

- ì•¡ì„  ìƒì„±ìë¥¼ í™œìš©í•˜ì—¬ ë¹„ë™ê¸° ì²˜ë¦¬

- ì•¡ì…˜ ìƒì„±ìê°€ ì•¡ì…˜ì„ ë¦¬í„´í•˜ì§€ ì•Šê³ , í•¨ìˆ˜ë¥¼ ë¦¬í„´í•¨

### ì„¤ì¹˜

```bash
yarn add redux-thunk
```

- middlewareëŠ” í•¨ìˆ˜ì´ê¸° ë•Œë¬¸ì— ë¼ì´ë¸ŒëŸ¬ë¦¬ë¶€í„° í•¨ìˆ˜ë¥¼ import í•œ ë‹¤ìŒì— í•¨ìˆ˜ë¥¼ applyMiddleware ì•ˆìœ¼ë¡œ ë„£ì–´ì•¼ í•¨

- thunk ëŠ” í•¨ìˆ˜ ìƒì„±ìê°€ í•¨ìˆ˜ë¥¼ return í• ë•Œë§Œ ë°˜ì‘í•˜ê³ , ì›ë˜ëŒ€ë¡œ action ê°ì²´ë¥¼ return í• ë•ŒëŠ” ê¸°ì¡´ ë™ì‘ ì²˜ëŸ¼ ë™ì‘í•˜ê¸° í•©ë‹ˆë‹¤.

```js
const store = createStore(todoApp, composeWithDevTools(applyMiddleware(thunk)));
```

- action.js ì—ì„œ Thunk í•¨ìˆ˜ì—ì„œ fetch API ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

```js
// action.js

export const getUsersThunk = () => {
  return async (dispatch) => {
    try {
      // getUsersStart ì•¡ì…˜ ì‹¤í–‰
      dispatch(getUsersStart());
      // API í˜¸ì¶œ
      const res = await axios.get("https://api.github.com/users");
      // í˜¸ì¶œ ì„±ê³µì‹œ response.data ê°€ì ¸ì˜´
      dispatch(getUsersSuccess(res.data));
      // ì—ëŸ¬ ë°œìƒì‹œ dispatch error ì‹¤í–‰
    } catch (error) {
      dispatch(getUsersFail(error));
    }
  };
};
```

- ê¸°ì¡´ fetch í•œê³³ì—ì„œëŠ” `getUsersThunk()` ë¥¼ í˜¸ì¶œí•´ì„œ ì‚¬ìš©í•©ë‹ˆë‹¤

```js
import { getUsersThunk } from "../redux/actions";

const getUsers = useCallback(() => {
  dispatch(getUsersThunk());
}, [dispatch]);
```

- ê¸°ì¡´ì—ëŠ” ë¹„ë™ê¸° ë¡œì§ì´ container ì—ì„œ ì´ë¤„ì¡Œë‹¤ë©´ redux-thunk ë¥¼ ì‚¬ìš©í•˜ë©´ action ì„ ë‹¤ë£¨ëŠ” action ìƒì„±í•¨ìˆ˜ì—ì„œ ì²˜ë¦¬í•˜ê²Œ ë˜ê³  container ëŠ” ê·¸ëƒ¥ action ìƒì„±ìë¥¼ component ì— ì „ë‹¬í•˜ëŠ” ì—­í™œì„ í•©ë‹ˆë‹¤

- ì´ë ‡ê²Œ ë ê²½ìš°ì—ëŠ” ì‹¤ì œë¡œ dispatch ë˜ëŠ” ë¡œì§ë“¤ì€ action ì—ì„œ ê´€ë¦¬ë˜ê¸° ë•Œë¬¸ì— ê´€ì‹¬ì‚¬ê°€ ì ì ˆíˆ ë¶„ë¦¬ê°€ ë©ë‹ˆë‹¤.

- ì´ì™€ê°™ì´ redux-thunk ëŠ” ë¹„ë™ê¸° ì‘ì—…í• ë•Œ ë³´ë‹¤ ì½”ë“œë¥¼ ê°„ê²°í™” í•˜ë©´ì„œ íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ ì…ë‹ˆë‹¤.

## 5.redux-promise-middleware

ğŸ”¶ ğŸ”· ğŸ“Œ ğŸ”‘

## Reference

- React redux official site - [https://react-redux.js.org/tutorials/quick-start](https://react-redux.js.org/tutorials/quick-start){:target="\_blank"}

- Redux middleware - [https://redux.js.org/understanding/history-and-design/middleware](https://redux.js.org/understanding/history-and-design/middleware){:target="\_blank"}
