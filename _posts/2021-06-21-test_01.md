---
title: "01.Unit Test (단위 테스트)"
excerpt: "Test"

categories:
  - Test

toc: true
toc_sticky: true
last_modified_at:
---

---

# 1.테스트 개요

## Unit Test 

- 단위(Unit) 테스트란 데이터(상태), 함수(메소드), 컴포넌트 등의 정의된 프로그램 최소 단위들이 독립적으로 정상 동작하는지 확인하는 방법. 

- 즉 주관적으로 정의된 것에 대한 하나하나를 테스트 하는 개념임. 

- 나중에 수정할 부분이 있으면 테스트 한 항목을 기반으로 더 안정적으로 수정을 할 수 있습니다.

- 작성한 로직이 코드위주로 테스트를 하기 때문에 가볍고, 더 빠르게 테스트를 진행 할 수 있습니다.

- 대표적인 Unit Test tool 로는 Jest 가 있습니다. (JavaScript test 용)


## E2E Test 

- E2E (End to End) 테스트란 어플리케이션의 처음부터 끝까지의 실제 사용자의 관점에서 사용 흐름을 테스트 하는 방법입니다.

- 실제 브라우저 화면에서 만들어진 사이트를 직접 사용하면서 사용하는 테스트입니다.

- 대표적인 E2E test tool 로는 cypress 가 있습니다.


# 2.테스트 환경설정 

- 예제 App test 파일로는 Jacob's DevLog 의 portfolio 에 있는 `Book-Search App` 을 통해 진행 하겠습니다. (Vue.js 기반)

- Vue.js 에서 unit test 를 진행하기 위해선 아래와 같은 package 를 설치 해야 합니다.

    - jest

    - vue test-utils

    - vue-jest

    - babel-jest


- package 설치

`$ npm i -D jest @vue/test-utils@next vue-jest@next babel-jest`


- root 경로에 `jest.config.js` 파일 생성 -> 테스트 할 환경설정 설정

```js
// in jest.config.js

module.exports = {
  // 파일 확장자를 지정하지 않은 경우, Jest 가 검색할 확장자 목록입니다.
  // 일반적으로 많이 사용되는 모듈의 확장자를 지정합니다.
  // e.g `import HellowWorld from '~/components/HelloWorld';`
  moduleFileExtensions: [
    'js',
    'vue'
  ],

  // `~` 와 같은 경로 별칭을 매핑합니다.
  // `< rootDir>` 토큰을 사용해 루트 경로를 참조할 수 있습니다.
  moduleNameMapper: {
    '^~/(.*)$': '<rootDir>/src/$1' // regexp 로 ~/ 로 시작되는 모든 문자열은 root 경로의 src 폴더안의 모든 경로를 말함
  },

  // 일치하는 경로에서는 모듈을 가져오지 않습니다.
  // `<rootDir>` 토큰을 사용해 루트 경로를 참조할 수 있습니다.
  modulePathIgnorePatterns: [
    '<rootDir>/node_modules',
    '<rootDir>/dist'
  ],

  // jsdom 환경에 대한 URL 을 설정합니다.
  // https://github.com/facebook/jest/issues/6766
  testURL: 'https://localhost',

  // 정규식과 일치하는 파일의 변환 모듈을 지정합니다.
  transform: {
    '^.+\\.vue$': 'vue-jest',
    '^.+\\.js$': 'babel-jest'
  }
}

```

- eslint 가 설치 되어 있으면 test 시 충돌 할 수 있기 때문에 사전에 정의된 전역 변수를 미리 설정 해주어야 합니다. root 경로에 있는  `.eslintrc.js` 에서..

```js
// in .eslintrc.js
module.exports = {
  // 사전에 정의된 전역 변수 설정
  env: {
    browser: true,
    node: true,
    jest: true
  }

```

# 3.초기 테스트 실행

- 예를 들어 하나의 js 파일을 test 하기 위해선 데이터(함수) 등을 export 할 수 있는 통로를 만들어 줘야지 test 작동 파일로 데이터를 내보내야 합니다. 다음과 같이 export 를 해주어야 합니다.

```js
// in example.js

export function double(num) {
  return num * 2
}
```

- 즉, vue 나 js 파일안에 있는 파일의 데이터나, 함수는 export 를 하지 않으면 결국 테스트를 할 수 없습니다.


- script 상에서 jest 를 사용할 수 있게 `packge.json` 파일에서 script 등록을 다음과 같이 해줍니다.

```json
  "scripts": {
    "test:unit": "jest --watchAl" // watchAll flag 은 변경사항이 발생 될 경우 자동으로 감지해서 test 환경을 다시한번 동작 시키는 flag 입니다
  }
```

- test 할 부분 작성

```js
// in example.test.js

import { expect, test } from '@jest/globals'
import { double } from './example'

test('Sample test', () => {
  expect(123).toBe(123)
})
```

- terminal 에서 `$ npm run test:unit` 을 실행하면 다음과 같음 같은 메세지가 출력됩니다.

![image](https://user-images.githubusercontent.com/28912774/122634253-12d06680-d118-11eb-9b20-811abaab8717.png)


- 만약 test 에서 fail 할 경우 다음과 같이 출력 됩니다.

```js
// in example.test.js

import { expect, test } from '@jest/globals'
import { double } from './example'

test('Sample test', () => {// expect 는 실제 들어오는 값이고, tobe 는 함수 실행 시, 출력이 예상되는 값을 가리킴 
  expect(123).toBe('123') // 일부로 123을 str 로 변환해서 test 진행 -> fail 유도
})
```
![image](https://user-images.githubusercontent.com/28912774/122634324-85414680-d118-11eb-84ed-e5726b79343d.png)


- `received` 는 받은 값을 의미하고, `expected` 는 기대되는 값을 가리키는데 두개의 값이 일치 하지 않기 때문에 `test` 에서 `fail` 이 나타나게 됨

- 마찬가지로 다른 test 를 실행합니다. 일단 `tobe()` 에 임의의 값을 입력하고, `test()` 를 실행하면 `fail` 이 나오는데 `expected` 값을 `received` 값으로 바꿔서 넣어주면 `pass` 가 됩니다


```js
import { expect, test } from '@jest/globals'
import { double } from './example'

test('parameter is a number', () => {
  expect(double(3)).toBe(7)
})
```

![image](https://user-images.githubusercontent.com/28912774/122638953-31435b80-d132-11eb-9b63-4b5872cc39a3.png)

![image](https://user-images.githubusercontent.com/28912774/122638986-589a2880-d132-11eb-80df-d159e1043880.png)


# 4.Jest Globals

> [Jest 전역 함수 자세히 보기](https://jestjs.io/docs/api)


## test()

- test 라는 전역 함수를 사용해서 각각의 용도로 구분해줌. 첫 번째 parameter 는 test 의 이름을 명시하고, 두번째 parameter로는 callBack 함수를 사용해서 실제 테스트를 진행 해주면 되는거임

- 예)
```js
test('did not rain', () => {
  expect(inchesOfRain()).toBe(0);
});
```

## describe()

- 테스트 함수들을 묶어 내는 함수. 일종의 test() 를 group 화 해준다는 것 

- 형식도 test() 와 마찬가지로 처음 parameter 는 이름, 두번째는 callback 함수를 사용함

- describe() 를 사용하는 이유는, before(), after() 함수를 사용하기 위해서 사용합니다


## beforeAll()

- 위와 마찬가지로 이름, callback 형태로 사용

- describe() 안에 모든 test 가 진행되기 전에 한번만 실행 합니다

## afterAll()

- 모든 test 가 진행되고 나서 다음에 시행될 것을 명시함

## beforeEach()

- 각각의 test 가 실행되기 직전에 한번씩 동작할 수 있는 구조

## afterEach()

- 각각의 test 가 끝나고 나서 한번씩 동작할 수 있는 구조

🔶 🔷  📌 🔑

## Reference

- vuex official page- [https://next.vuex.vuejs.org/](https://next.vuex.vuejs.org/){:target="\_blank"}


