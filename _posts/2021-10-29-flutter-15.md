---
title: "Flutter Json (Json_serializable)"
excerpt: "flutter"

categories:
  - flutter

toc: true
toc_sticky: true
---

# Json

- ëª¨ë“  í˜•íƒœì˜ ì›¹ / ëª¨ë°”ì¼ App ì€ API ì™€ í†µì‹ í•˜ê¸° ìœ„í•´ Json ì„ í•„ìˆ˜ ì ìœ¼ë¡œ ì‚¬ìš©ë˜ê²Œ ë©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜, Json ì˜ ë°ì´í„°ì˜ ì–‘ì´ ë§ì•„ ì§ˆ ìˆ˜ë¡ êµ¬ì¡°ê°€ ì ì  ë³µì¡í•˜ê²Œ ë˜ì–´ì ¸ì„œ ì‚¬ìš©í•˜ê¸° ë¶ˆí¸í• ë•Œê°€ ë§ìŠµë‹ˆë‹¤. (nesting í˜•íƒœë¡œ key : value ì—ì„œ value ê°€ ë‹¤ë¥¸ object ë¥¼ ê°€ì ¸ì„œ í•˜ìœ„ë¡œ ê³„ì† key: value í˜•íƒœë¡œ ê°€ì§€ì¹˜ê¸°ê°€ ë ë•Œ ë°ì´í„°ì˜ ì–‘ì´ ë§ì•„ì§ˆ ìˆ˜ ë¡ ê´€ë¦¬í•˜ê¸°ê¸° ë³µì¡í•˜ê²Œ ë©ë‹ˆë‹¤)

## Json ì— ëŒ€í•´ ê°„ë‹¨ ì •ë¦¬

- Most widely used dat format for data interchange on the web interface

- Primary data structure of Json

  - A collection of name / value pairs

  - An ordered list of values

- Json seperator / token

  - ":"(between name and value), ","(between name / value pairs), "{","}" (for object), "[","]"(for arrays)

- Json values

  - String, numbers, objects, arrays, booleans, null(or empty)

- íŠ¹íˆ, flutter ì—ì„œ Json ì„ ì‚¬ìš©í• ë•Œ map ì„ ì‚¬ìš©í•´ì„œ string type ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ”ë° Json ì˜ value ì˜ type ì´ dynamic ì´ ë˜ê¸° ë•Œë¬¸ì— ë‚˜ì¤‘ì— type checking í•  ë•Œ, ì—ëŸ¬ê°€ ë§ì´ ë°œìƒ ë©ë‹ˆë‹¤. ê·¸ë˜ì„œ ê·¸ê²ƒì„ ë°©ì§€í•˜ê³ ì ì£¼ë¡œ, class ë¥¼ ë§Œë“¤ì–´ì„œ converting í•˜ëŠ”ë° ë‘ê°€ì§€ function ì„ ë§Œë“œëŠ”ë°, `fromJson()`, `toJson()` ì´ë¼ëŠ” method ë¥¼ ë§Œë“­ë‹ˆë‹¤. ê·¼ë° ê·¸ ë§Œë“œëŠ” ê³¼ì •ì´ ë°ì´í„°ê°€ ë§ì„ ê²½ìš° ì½”ë“œì˜ ì–‘ì´ ìƒë‹¹íˆ ë§ì•„ì§€ê³  ì‹œê°„ë„ ë§ì´ ì†Œìš” ë©ë‹ˆë‹¤

- ì´ëŸ¬í•œ ê³¼ì •ì„ ìë™í™” í•  ìˆ˜ ìˆê³  error ë¥¼ ë¯¸ë¦¬ ë°©ì§€í•˜ê¸° ìœ„í•´ì„œ flutter ì—ì„œëŠ” ì£¼ë¡œ Json_serializable package ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤

![image](https://user-images.githubusercontent.com/28912774/139372522-213c38b1-30ab-4040-bf3c-03539d60d816.png)

![image](https://user-images.githubusercontent.com/28912774/139372694-a2fe3186-7b56-4ea9-a922-9b208982934b.png)

![image](https://user-images.githubusercontent.com/28912774/139372773-5546ec21-abcc-4e03-86ba-247fc13ddf97.png)

## serialization, deserialization ?

- Encoding == serialization == data structure ë¥¼ string íƒ€ì…ìœ¼ë¡œ ë³€ê²½

- Decoding == deserialization == string íƒ€ì…ì„ data structure ë¡œ ë³€ê²½

# Json ì„ serialization í•˜ëŠ” 2ê°€ì§€ ë°©ë²•

- Manual Serialization (ìˆ˜ë™ ì§ë ¬í™”) - `dart:convert` ì‚¬ìš©í•´ì„œ ì§ì ‘ ì½”ë“œë¥¼ ì‘ì„±í•´ì„œ ì§ë ¬í™” í•˜ê¸°

- Automated serialization using code generation (ì½”ë“œ ìƒì„±ì„ í†µí•œ ìë™ ì§ë ¬í™”) - json_serializable, built_value ë“± ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•´ì„œ Json ì§ë ¬í™” í•˜ê¸°

## Manual Serialization

- ë°ì´í„° ì–‘ì´ ì–¼ë§ˆ ì—†ì„ë•Œ ì£¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤

### ì˜ˆì‹œ

```json
var jsonString = '{
  "name" : "Jacob ko",
  "email" : "jacobko@info.com",
  "age" : 30
}'
```

ìœ„ì˜ Json í˜•ì‹ì˜ ë°ì´í„°ë¥¼ serialization í•˜ê¸°ìœ„í•´ì„œ ë‹¤ìŒê³¼ ê°™ì´ ì§„í–‰ í•©ë‹ˆë‹¤.

- User í´ë˜ìŠ¤ ìƒì„±

- User.formJson() ìƒì„±ìë¥¼ ë§Œë“¤ì–´ì„œ map ìœ¼ë¡œ ë¶€í„° User ë¥¼ ìƒì„±í•©ë‹ˆë‹¤

- User.toJson() ë°˜ëŒ€ë¡œ User ë¥¼ map í˜•íƒœë¡œ ë³€í™˜ ì‹œí‚µë‹ˆë‹¤

```dart

// Manual Serialization ì˜ˆì‹œ
// user.dart

class User {
  final String name;
  final String email;
  final int age;

  User({required this.name, required this.email, required this.age});

// fromJson
  User.fromJson(Map<String, dynamic> json)
      : name = json['name'],
        email = json['email'],
        age = json['age'];

// toJson
  Map<String, dynamic> toJson() => {'name': name, 'email': email, 'age': age};
}

Map userMap = jsonDecode(jsonString);
var user = User.fromJson(userMap);

print('How are you ${user.name}');
print('We sent the verification link to ${user.email}.');


String json = jsonEncode(user);

```

## json_serializable package ì„¤ì¹˜

```yaml
dependencies:
  # ì‹¤ì œ deploy í• ë•Œ json í˜•íƒœ ì‚¬ìš©ë˜ëŠ” package
  json_annotation:

dev_dependencies:
  # build_runner: json_serializable ì˜ spec ì— ë§ê²Œ data êµ¬ì¡°ë¥¼ ë§Œë“¤ê³ , ë³€í™˜ ì‹œí‚¬ë•Œ ì‚¬ìš©ë˜ëŠ” package
  build_runner:
  json_serializable:
```

## json_serializable ì„ ì‚¬ìš©í•´ json ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ê¸°

```dart
import 'package:json_annotation/json_annotation.dart';

// This allows the `User` class to access private members in
// the generated file. The value for this is (íŒŒì¼ëª…:*).g.dart, where
// the star denotes the source file name.

// ìë™í™” ìƒì„± ë˜ëŠ” íŒŒì¼ëª… ì œì‹œ (ëŒ€ë¶€ë¶„ ì´ëŸ¬í•œ íŒ¨í„´ìœ¼ë¡œ ìƒì„±ë¨)
part 'user.g.dart'; // ì´ë¶€ë¶„ì—ì„œ ì—ëŸ¬í‘œì‹œê°€ ë°œìƒí•¨.

// JSON ì§ë ¬í™” ë¡œì§ì´ ë§Œë“¤ì–´ì ¸ì•¼ í•œë‹¤ê³  ì•Œë¦¼ ì–´ë…¸í…Œì´ì…˜
@JsonSerializable()

class User {
  User(this.name, this.email. this.registDateMill);

  String name;
  String email;

// @JsonKeyë¥¼ ì‚¬ìš©í•˜ì—¬ ë„¤ì´ë°ì „ëµì„ ì•Œë ¤ì¤„ìˆ˜ ìˆë‹¤.
// name: ë„¤ì´ë° ì „ëµ, required(t/f): ë¬´ì¡°ê±´ í¬í•¨í•´ì•¼ í•˜ëŠ” í‚¤ ì¸ì§€ ì—¬ë¶€,
//defaultValue(t/f): Jsonì— í•´ë‹¹ í‚¤ê°€ ì—†ì–´ë„ ë˜ê±°ë‚˜ ê°’ì´ 'null'ì¸ ê²½ìš°.

@JsonKey(name: 'registration_date_millis')
final int registrationDateMillis;

/// mapì—ì„œ Userë¥¼ ìƒì„±í•˜ê¸° ìœ„í•œ íŒ©í† ë¦¬ ìƒì„±ì.
/// Pass the map to the generated `_$UserFromJson()` constructor.
/// ìƒì„±ìì˜ ì´ë¦„ì€ í´ë˜ìŠ¤ ëª…ì„ ë”°ë¥¸ë‹¤. ( _$+í´ë˜ìŠ¤ëª…+FromJson )
factory User.fromJson(Map<String, dynamic> json) => _$UserFromJson(json);

  /// `toJson` JSON  ì¸ì½”ë”©ì„ ì§€ì›ì„ ì„ ì–¸í•˜ëŠ” ê·œì¹™.
  /// The implementation simply calls the private, generated
  /// helper method `_$UserToJson`. ( _$+í´ë˜ìŠ¤ëª…+ToJson)
  Map<String, dynamic> toJson() => _$UserToJson(this);
}
```

- ìœ„ì˜ ì½”ë“œë¥¼ ì‘ì„±í•˜ê³  í„°ë¯¸ë„ì—ì„œ `flutter pub run build_runner build` ì‹¤í–‰í•˜ë©´ ë™ì¼ ê²½ë¡œì— `user.g.dart` ì— code generation ì´ ìƒì„±ëœë‹¤. ì¼íšŒì„±ì´ ì•„ë‹Œ ì§€ì†ì ì¸ ë³€ê²½ ê°ì§€ë¥¼ ìœ„í•´ `watch` ëª¨ë“œë¥¼ ì‹¤í–‰í•˜ë©´ ëœë‹¤
  `flutter pub run build_runner watch` ì‹¤í–‰

- ì‚¬ìš©ë²•ì€ manual ë¶€ë¶„ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ì‹¤í–‰í•˜ë©´ ë©ë‹ˆë‹¤

```dart
Map userMap = jsonDecode(jsonString);
var user = User.fromJson(userMap);

String json = jsonEncode(user);
```

## json_serializable package ì‹¤ì „ ì‚¬ìš© ì˜ˆì‹œ

> [OpenWeather API](https://openweathermap.org/api)

Json í˜•íƒœì˜ OpenWeather API ë¥¼ ì˜ˆì‹œë¡œ fetch data ë¥¼ í•´ì„œ json_serializable íŒ¨í‚¤ì§€ë¥¼ í†µí•´ flutter ì—ì„œ Json ì‚¬ìš©í•˜ëŠ” ì˜ˆì‹œ ì½”ë“œ ì…ë‹ˆë‹¤.

```json
// https://api.openweathermap.org/data/2.5/weather?q=seoul&appid=$KEY

{
  "coord": {
    "lon": 126.9778,
    "lat": 37.5683
  },
  "weather": [
    {
      "id": 800,
      "main": "Clear",
      "description": "clear sky",
      "icon": "01n"
    }
  ],
  "base": "stations",
  "main": {
    "temp": 285.09,
    "feels_like": 284.06,
    "temp_min": 281.38,
    "temp_max": 286.88,
    "pressure": 1024,
    "humidity": 66
  },
  "visibility": 10000,
  "wind": {
    "speed": 0.51,
    "deg": 150
  },
  "clouds": {
    "all": 0
  },
  "dt": 1635508436,
  "sys": {
    "type": 1,
    "id": 8105,
    "country": "KR",
    "sunrise": 1635458015,
    "sunset": 1635496672
  },
  "timezone": 32400,
  "id": 1835848,
  "name": "Seoul",
  "cod": 200
}
```

```dart
// open_weather_screen.dart (UI widget)

import 'dart:convert';

import 'package:flutter/material.dart';
import 'package:http/http.dart' as http;

// json model
import 'package:json/models/open_weather/open_weather.dart';


class OpenWeatherScreen extends StatelessWidget {

  // Future type getWeather í•¨ìˆ˜
  Future<OpenWeather> getWeather() async {
    try {
      const String url =
          'http://api.openweathermap.org/data/2.5/weather?q=seoul&appid=$KEY';

      final http.Response response = await http.get(url);
      final responseData = json.decode(response.body);
      final OpenWeather ow = OpenWeather.fromJson(responseData);

      // Json í˜•íƒœë¡œ í™•ì¸
      print(ow.toJson());

      return ow;
    } catch (err) {
      print(err);
      throw err;
    }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text('Flat Weather'),
      ),
      // FutureBuilder ìƒì„±
      body: FutureBuilder(
        future: getWeather(),
        builder: (context, snapshot) {
          if (snapshot.hasData) {
            final ow = snapshot.data;

            return ......

            } else if (snapshot.hasError) {
            return Center(
              child: Text(
                'Error: ${snapshot.error}',
                style: TextStyle(
                  fontSize: 24,
                ),
              ),
            );
          } else {
            return Center(
              child: CircularProgressIndicator(),
            );
          }
        },
      ),
    );
  }
}
```

```dart
// in coord.dart

*/ nesting ë¶€ë¶„ëœ ì¼ë¶€ë¶„ ì²˜ë¦¬ë¥¼ ìœ„í•œ model class ìƒì„±
  "coord": {
    "lon": 126.9778,
    "lat": 37.5683
  },
*/



import 'package:json_annotation/json_annotation.dart';

part 'coord.g.dart';

@JsonSerializable()
class Coord {
  final double lon;
  final double lat;

  Coord({required this.lon, required this.lat});

  factory Coord.fromJson(Map<String, dynamic> json) => _$CoordFromJson(json);
  Map<String, dynamic> toJson() => _$CoordToJson(this);
}
```

```dart

import 'package:json_annotation/json_annotation.dart';

// ì•„ë˜ì˜ ìë™í™”ëœ code source ë¥¼ coord.g.dart íŒŒì¼ì— ë„£ìœ¼ë¼ëŠ” ê²ƒ
part 'main.g.dart';

@JsonSerializable()
class Main {
  final double temp;
  // ì‹¤ì œë¡œ API ì—ì„œ ë¶ˆëŸ¬ì˜¬ë•Œ ì˜ ì›ë˜ì˜ ê°’ì„ @JsonKey ë¡œ ì§€ì •í•´ì¤˜ì„œ camelCase ë¡œ ë³€ê²½í•´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ key ê°’ì„ ë§¤ì¹­ í•´ì£¼ëŠ” ê²ƒì„
  @JsonKey(name: 'feels_like')
  final double feelsLike;
  @JsonKey(name: 'temp_min')
  final double tempMin;
  @JsonKey(name: 'temp_max')
  final double tempMax;
  final int pressure;
  final int humidity;

  Main(
      {required this.temp,
      required this.feelsLike,
      required this.tempMin,
      required this.tempMax,
      required this.pressure,
      required this.humidity});

  factory Main.fromJson(Map<String, dynamic> json) => _$MainFromJson(json);
  Map<String, dynamic> toJson() => _$MainToJson(this);
}
```

```dart
// in weather.dart

import 'package:json_annotation/json_annotation.dart';

// ì•„ë˜ì˜ ìë™í™”ëœ code source ë¥¼ coord.g.dart íŒŒì¼ì— ë„£ìœ¼ë¼ëŠ” ê²ƒ
part 'weather.g.dart';

@JsonSerializable()
class Weather {
  final int id;
  final String main;
  final String description;
  final String icon;

  Weather({
    required this.id,
    required this.main,
    required this.description,
    required this.icon,
  });

  factory Weather.fromJson(Map<String, dynamic> json) =>
      _$WeatherFromJson(json);
  Map<String, dynamic> toJson() => _$WeatherToJson(this);
}

```

```dart
// coord.dart , main.dart, weather.dart ì—ì„œ ìƒì„±ëœê²ƒì„ ì¢…í•©í•˜ê¸°

import 'package:json_annotation/json_annotation.dart';
import 'package:json_serializable_practice/models/open_weather/coord.dart';
import 'package:json_serializable_practice/models/open_weather/main.dart';
import 'package:json_serializable_practice/models/open_weather/weather.dart';

// ì•„ë˜ì˜ ìë™í™”ëœ code source ë¥¼ coord.g.dart íŒŒì¼ì— ë„£ìœ¼ë¼ëŠ” ê²ƒ
part 'open_weather.g.dart';

@JsonSerializable(explicitToJson: true)
class OpenWeather {
  final Coord coord;
  final List<Weather> weather;
  final Main main;
  final int visibility;

  OpenWeather(
      {required this.coord,
      required this.weather,
      required this.main,
      required this.visibility});

  factory OpenWeather.fromJson(Map<String, dynamic> json) =>
      _$OpenWeatherFromJson(json);
  Map<String, dynamic> toJson() => _$OpenWeatherToJson(this);
}

```

---

ğŸ”¶ ğŸ”· ğŸ“Œ ğŸ”‘

## Reference

json_serializable pub.dev - [https://pub.dev/packages/json_serializable](https://pub.dev/packages/json_serializable)

Heavy Fran - [https://youtu.be/DgLLC4hiUgE](https://youtu.be/DgLLC4hiUgE)

ìëª½ì´ë‘ê¼¬ë¶€ê¸° For Programming Code!! - [https://hellowk1.blogspot.com/2020/10/flutterjson-and-serialization-1.html?view=sidebar](https://hellowk1.blogspot.com/2020/10/flutterjson-and-serialization-1.html?view=sidebar)
