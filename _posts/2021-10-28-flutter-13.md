---
title: "Bloc Pattern"
excerpt: "flutter"

categories:
  - flutter

toc: true
toc_sticky: true
---

# 1.ì™œ? Bloc Pattern ì¨ì•¼ í•˜ëŠ”ê°€?

- ëª¨ë“  flutter app ì€ Stateful Widget ì„ ì‚¬ìš©í•´ì„œ ë™ì ì¸ í™”ë©´ì„ ë³€ê²½ì„ `setState()` ë¥¼ ì‚¬ìš©í•´ì„œ ì‰½ê²Œ êµ¬í˜„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- í•˜ì§€ë§Œ, ì´ëŸ°í•œ êµ¬ì¡°ëŠ” ë‹¨ìˆœí•œ ìœ„ì ¯ì˜ êµ¬ì¡° ì¼ ê²½ìš°ì— í•´ë‹¹ë˜ëŠ” ë¶€ë¶„ì´ê³ , ë³´í†µ App ì„ ë§Œë“¤ê³  ì‚¬ìš©ìë“¤ì—ê²Œ ë°°í¬ë¥¼ í•  ê²½ìš° ì„œë²„ë¡œ ë¶€í„° data ë¥¼ ë°›ì•„ì˜¤ê±°ë‚˜, local ì— ìˆëŠ” data ë¥¼ business logic ë¥¼ í†µí•´ ë§Œë“¤ê²½ìš° ë³µì¡í•œ Widget tree ê°€ ë˜ê²Œ ë©ë‹ˆë‹¤. ì´ëŸ¬í•œ ê²½ìš°ì— `setState()` ë¡œë§Œ ì‚¬ìš©í•´ì„œ data ë¥¼ ë³€ê²½ í•  ê²½ìš° ë” ë³µì¡í•˜ê²Œ ë©ë‹ˆë‹¤

- ì´ëŸ¬í•œ ë¶ˆí¸í•˜ê³ , ë³µì¡í•œ ë¶€ë¶„ì„ í•´ê²°í•˜ê¸° ìœ„í•´ Bloc (Business Logic Component) pattern ì´ë¼ê³  í•©ë‹ˆë‹¤. ë§ ê·¸ëŒ€ë¡œ Business logic ì„ ë”°ë¡œ ë•Œë‚´ì–´ ë¶„ë¦¬í•œ ì¼ì¢…ì˜ component ì…ë‹ˆë‹¤.

- UI ë¶€ë¶„ì—ì„œëŠ” business ë¶€ë¶„ì„ ê´€ì—¬í•  í•„ìš”ê°€ ì—†ê²Œ ë˜ë©°, data ì˜ ê°’ì„ ê°€ê³µí•  í•„ìš”ê°€ ì—†ê²Œ ë˜ê³  bloc pattern ë¡œ ì •ë¦¬ëœ data ë¥¼ ê·¸ëŒ€ë¡œ ë°›ì•„ì„œ ë³´ì—¬ì£¼ê¸°ë§Œ í•˜ë©´ ë˜ê³ , ëª¨ë“  business logic ì€ bloc pattern ì—ì„œ ë‹¤ë£¨ê²Œ ë©ë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/28912774/139241486-f5f912ea-be8d-4c0c-bade-54126b320670.png)

- ìœ„ì˜ ê·¸ë¦¼ì—ì„œëŠ” UI widget ì—ì„œëŠ” events ë§Œ bloc ì— ë„˜ê¸°ê³  bloc ì•ˆì— transition ì´ë¼ë˜ì§€ ëª¨ë“  state ëŠ” bloc ì•ˆì—ì„œ Streams ë¡œ UI widget ì— ë„˜ê¸°ê²Œ ë©ë‹ˆë‹¤

- bloc pattern ì˜ ê°€ì¥ í° ì¥ì ì€ state ë¥¼ widget tree ìƒì—ì„œ ê´€ë¦¬í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì˜ˆì „ì—ëŠ” ë§Œì•½ `scaffold ` ìƒì˜ `setState()` ë¥¼ ë³€ê²½í• ë•ŒëŠ” ì „ì²´ widget tree ì—ì„œ build context ì—ì„œ reload ê°€ ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— tree êµ¬ì¡°ê°€ ë³µì¡í•  ê²½ìš°, app êµ¬ë™ ì†ë„ê°€ ë¹¨ë¼ ì§‘ë‹ˆë‹¤

![image](https://user-images.githubusercontent.com/28912774/139245328-f15f5363-4f06-492a-8da2-a83dd679e75f.png)

![image](https://user-images.githubusercontent.com/28912774/139245228-9535dabd-7a48-4b70-99c1-9c70f3560f27.png)

## Bloc pattern ì˜ ë‹¨ì 

- ê´€ë¦¬ë˜ëŠ” íŒŒì¼ì´ ë§ì´ ì§‘ë‹ˆë‹¤. (state ë¥¼ ë‹¤ë£¨ëŠ”ê²Œ í•˜ë‚˜ì˜ Bloc ë§Œ ìˆëŠ”ê²ƒì´ ì•„ë‹ˆë¼, ë‹¤ìˆ˜ì˜ Bloc ì´ ìˆì„ ê²ƒì¸ë°, ê´€ë¦¬í•˜ê¸°ê°€ ë³µì¡í•˜ê³ , `setState()` ì™€ ë¹„êµí•´ë„ ë³µì¡í•œ êµ¬ì¡°ë¥¼ ê°€ì§€ê³  ìˆê²Œ ë©ë‹ˆë‹¤)

- ê·¸ê²ƒì„ ë³´ì•ˆí•˜ê¸° ìœ„í•´ì„œ ë‚˜ì˜¨ê²ƒì´ `Provider` ê°€ ìˆìŠµë‹ˆë‹¤

## Bloc pattern code ì˜ˆì‹œë¡œ

- flutter ì„¤ì¹˜ì‹œ demo ë¡œ ë³´ì´ëŠ” ìˆ«ì count ë˜ëŠ” í™”ë©´ì„ bloc pattern ìœ¼ë¡œ ë§Œë“  ì˜ˆì‹œ ì…ë‹ˆë‹¤

![image](https://user-images.githubusercontent.com/28912774/139354445-ef1f6ce6-92dc-4aeb-afff-028dd5c8eece.png)

êµ¬ì¡°ëŠ” ui ë¶€ë¶„ ui ë¶€ë¶„ì˜ body ë¶€ë¶„ì€ component ë¡œ ë¶„ë¦¬í•´ì„œ `count_view.dart` íŒŒì¼ë¡œ ì´ë£¨ì–´ ì ¸ìˆê³  ëª¨ë“  state ê°’ì€ bloc í´ë”ì— `count_bloc.dart` ì— ìœ„ì¹˜í•˜ê²Œ ë©ë‹ˆë‹¤

```dart
// in main.dart

class _HomeState extends State<Home> {
  @override
  Widget build(BuildContext context) {
    return SafeArea(
      child: Scaffold(
        body: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          crossAxisAlignment: CrossAxisAlignment.stretch,
          children: [
            Center(
              child: ElevatedButton(
                child: Text("bloc íŒ¨í„´"),
                onPressed: () {
                  Navigator.push(context, MaterialPageRoute(builder: (_) {
                    return BlocDisplayWidget();
                  }));
                },
              ),
            ),
          ],
        ),
      ),
    );
  }
}

```

```dart
// in bloc_display_widget.dart

// Global ë³€ìˆ˜ìƒì„±
CountBloc countBloc;

class BlocDisplayWidget extends StatefulWidget {
  BlocDisplayWidget({Key key}) : super(key: key);

  @override
  _BlocDisplayWidgetState createState() => _BlocDisplayWidgetState();
}

class _BlocDisplayWidgetState extends State<BlocDisplayWidget> {
  // initState() : Bloc ìƒì„±
  @override
  void initState() {
    super.initState();
    countBloc = CountBloc();
  }

  // dispose() : í˜ì´ì§€ê°€ ë‹«íˆë©´ app ì´ dispose ë˜ê²Œ í•¨
  @override
  void dispose() {
    super.dispose();
    countBloc.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text("bloc íŒ¨í„´"),
      ),
      body: CountView(countBloc: countBloc),
      floatingActionButton: FloatingActionButton(
        child: Icon(Icons.add),
        onPressed: () {
          countBloc.add();
        },
      ),
    );
  }
}

```

```dart
// in count_view.dart

class CountView extends StatelessWidget {
  CountBloc countBloc;
  CountView({Key key, this.countBloc}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    print("CountView Build!!");
    return Center(
      child: StreamBuilder(
        stream: countBloc.count,
        initialData: 0,
        // AsyncSnapshot ìœ¼ë¡œ ê°’ì´ ë“¤ì–´ì˜¤ê²Œ ë¨
        builder: (BuildContext context, AsyncSnapshot<int> snapshot) {
          if (snapshot.hasData) {
            return Text(
              snapshot.data.toString(),
              style: TextStyle(fontSize: 70.0),
            );
          }
          return CircularProgressIndicator();
        },
      ),
    );
  }
}

```

```dart
// in count_bloc.dart

class CountBloc {
  int _count = 0;
  final StreamController<int> _countSubject = StreamController<int>();
  // ë³€ê²½ëœ widget ê°’ì„ ì „ë‹¬ í•˜ê²Œ ë¨
  Stream<int> get count => _countSubject.stream;

  add() {
    _count++;
    _countSubject.sink.add(_count);
  }

  dispose() {
    _countSubject.close();
  }
}

```

# 2.flutter_bloc package

> [flutter_bloc_package](https://pub.dev/packages/flutter_bloc)

- bloc pattern ì„ flutter ì— ì ìš©í• ê²½ìš°, package ì—†ì´ ê·¸ëƒ¥ custom í•˜ê²Œ ë  ê²½ìš° ì‘ì„±í•´ì•¼ë  ê²½ìš°ê°€ ë„ˆë¬´ ë§ê²Œ ë˜ê³  ê´€ë¦¬ë„ ë³µì¡í•˜ê¸° ë•Œë¬¸ì— flutter ì—ì„œ bloc íŒ¨í„´ ì‚¬ìš©ì‹œ ì£¼ë¡œ flutter_bloc_package ë¥¼ ì„¤ì¹˜í•´ì„œ ì‚¬ìš©í•˜ê²Œ ë©ë‹ˆë‹¤

---

ğŸ”¶ ğŸ”· ğŸ“Œ ğŸ”‘

## Reference

Getting Started with the BLoC Pattern - [https://www.raywenderlich.com/4074597-getting-started-with-the-bloc-pattern](https://www.raywenderlich.com/4074597-getting-started-with-the-bloc-pattern)

BLoC in Flutter: Implement Clean, Flux-like Architecture - [https://everyday.codes/mobile/bloc-in-flutter-implement-clean-flux-like-architecture/](https://everyday.codes/mobile/bloc-in-flutter-implement-clean-flux-like-architecture/)

ê°œë°œí•˜ëŠ”ë‚¨ì - [https://youtu.be/AY6i0a4BM7o](https://youtu.be/AY6i0a4BM7o)

ì½”ë“œíŒ©í† ë¦¬ - [https://youtu.be/xlmkMF5kVvA](https://youtu.be/xlmkMF5kVvA)
