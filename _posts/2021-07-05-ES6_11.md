---
title: "21.ë¹„ë™ê¸° (callBack, Promise, async / await) - ES6"
excerpt: "JavaScript"

categories:
  - JavaScript

toc: true
toc_sticky: true
last_modified_at:
---

---


## 1.callback

### JS ëŠ” í•­ìƒ ë™ê¸°ì‹ ì²˜ë¦¬ (synchronous)

- ë™ê¸°ì‹ ì²˜ë¦¬ê°€ ë­ëƒë©´ í•œë²ˆì— ì½”ë“œ í•œì¤„ì”© ì°¨ë¡€ì°¨ë¡€ ì‹¤í–‰ëœë‹¤ëŠ” ì†Œë¦¬ì…ë‹ˆë‹¤. 

- ìë°”ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ëŠ” ì›¹ë¸Œë¼ìš°ì €ëŠ” stackì´ë¼ëŠ” ì½”ë“œ ì‹¤í–‰ ê³µê°„ì´ ìˆëŠ”ë° ê±°ê¸°ì„œ ì½”ë“œë¥¼ í•œì¤„í•œì¤„ ì°¨ë¡€ë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤. 


### ì˜ˆì™¸ì˜ ê²½ìš° (asynchronous)

- ë‹¨ ì˜ˆì™¸ë¡œ, ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¬ëŠ” code ëŠ” stack ì—ì„œ ì œì™¸ ì‹œì¼œ web API ë¼ëŠ” ê³³ì—ì„œ ì €ì¥ ì‹œí‚¤ê³  ë‚˜ì¤‘ì— code ë¥¼ ì‹¤í–‰ ì‹œí‚µë‹ˆë‹¤ (`ajax, setTimeout, eventLister` ë“±)


- ì´ëŸ° ì²˜ë¦¬ë°©ì‹ì„ ë°”ë¡œ ë¹„ë™ê¸°(asynchronous)ë¼ê³  í•©ë‹ˆë‹¤. 

- ì‹¤í–‰ì´ ì˜¤ë˜ê±¸ë¦¬ëŠ” ê·¸ëŸ° ì½”ë“œë“¤ì€ ì ê¹ ëŒ€ê¸°ì‹¤ì— ì œì³ë‘ê³ , ì‹¤í–‰ì´ ë°”ë¡œë°”ë¡œ ê°€ëŠ¥í•œ ì½”ë“œë“¤ë¶€í„° ì²˜ë¦¬í•˜ëŠ” ë°©ì‹ì„ ëœ»í•©ë‹ˆë‹¤. 

- ì´ê±´ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì–¸ì–´ ìì²´ì˜ ê¸°ëŠ¥ì´ ì•„ë‹ˆë¼ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ì„ ë„ì™€ì£¼ëŠ” ì›¹ë¸Œë¼ìš°ì € ë•ë¶„ì— í•´ë‚¼ ìˆ˜ ìˆëŠ” ê²ƒì…ë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/28912774/125013963-bd98cc80-e0a7-11eb-945f-45718747a337.png)


### ì ê¹ ì½”ë“œë¥¼ ì œì³ë‘ëŠ” ëŒ€ê¸°ì‹¤ì¸ Web API


- ì‹¤í–‰ì„ ë¯¸ë£¨ê³  ì˜†ìœ¼ë¡œ ì ê¹ ì œê»´ë‘˜ ìˆ˜ ìˆëŠ” ì½”ë“œë“¤ì€ ë¯¸ë¦¬ ì •í•´ì ¸ìˆìŠµë‹ˆë‹¤. ìœ„ì—ì„œ ë§í–ˆë˜ `setTimeout`, `addEventListener`, `ajax` ê´€ë ¨ í•¨ìˆ˜ë“¤ì´ ë°”ë¡œ ê·¸ê²ƒì…ë‹ˆë‹¤. 

- `setTimeout`, `addEventListener`, `ajax`ê´€ë ¨ í•¨ìˆ˜ë“¤ì€ 1ì´ˆëŒ€ê¸°, í´ë¦­ëŒ€ê¸° ì´ëŸ°ê±¸ í•˜ëŠ” ì½”ë“œë“¤ì¸ë°ì´ëŸ° ì½”ë“œë“¤ì˜ íŠ¹ì§•ì€.. ì½ëŠ” ì‹œì ê³¼ ë™ì‘ ì‹œì ì´ ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤. (ì‰½ê²Œ ë§í•˜ë©´ ë™ì‘ê¹Œì§€ ì˜¤ë˜ê±¸ë¦½ë‹ˆë‹¤.)

 


### callback í•¨ìˆ˜ë¥¼ ì´ìš©í•œ ìˆœì°¨ì  ì‹¤í–‰


Q. ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ 1ì´ˆ í›„ì— ì½”ë“œë¥¼ ì‹¤í–‰í•˜ê³  ì‹¶ìœ¼ë©´ ì–´ë–»ê²Œ í• ê¹Œìš”?

```js
console.log(1);
setTimeout(function(){
  console.log(2);
}, 1000);
console.log(3);
```

A. ê·¸ëŸ¬ë©´ ì½˜ì†”ì°½ì— 1ê³¼ 3ì´ ë¨¼ì € ë¹ ë¥´ê²Œ ì¶œí˜„í•˜ê³  ê·¸ ë‹¤ìŒ 1ì´ˆ í›„ì— 2ë¼ëŠ” ìˆ«ìê°€ ì¶œí˜„í•©ë‹ˆë‹¤. 


- ìë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” ë¹„ë™ê¸°ìƒí™© ë“±ì—ì„œ ì½”ë“œë¥¼ **ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰í•˜ê³  ì‹¶ì„ ë•Œ ì½œë°±í•¨ìˆ˜**ë¥¼ ì ê·¹ í™œìš©í•©ë‹ˆë‹¤.

- callback í•¨ìˆ˜ë€ ì‰½ê²Œ ë§í•´ì„œ í•¨ìˆ˜ì•ˆì— ë“¤ì–´ê°€ëŠ” í•¨ìˆ˜ë¥¼ callback í•¨ìˆ˜ë¼ê³  í•©ë‹ˆë‹¤.

- ê·¸ëŸ¬ë‚˜ callback í•¨ìˆ˜ê°€ ë§ì•„ì§€ë©´ ì†ì¹­, callback ì§€ì˜¥ì—ì„œ ë¹ ì ¸ ì½”ë“œë¥¼ ì½ì„ë•Œ ì–´ë ¤ì›€ì´ ìˆìŠµë‹ˆë‹¤.

```js
first(function(){
  second(function(){
    thrid(function(){
      ... // ìœ„ì™€ ê°™ì´ callback í•¨ìˆ˜ì˜ ì—°ì†ì€ ì¢‹ì€ code ê°€ ì•„ë‹ˆê²Œ ë¨
    });
  });
}):
```

- ê·¸ë ‡ê²Œ ë•Œë¬¸ì— callback í•¨ìˆ˜ë¥¼ ë³´ê¸° ì¢‹ê²Œ í•˜ê¸° ìœ„í•´ì„œ `Promise` ë¥¼ ì‚¬ìš©í•˜ê²Œ ë©ë‹ˆë‹¤.


```js
first().then(function(){
   // second ì—ì„œ ì‹¤í–‰ í•  ì½”ë“œ
}).then(function(){
   // third ì—ì„œ ì‹¤í–‰í•  ì½”ë“œ 
});
```

- `Promise` ë¥¼ ì‚¬ìš©í•˜ê²Œ ë˜ë©´ ì¢€ ë” ì§ê´€ì ìœ¼ë¡œ code ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


## 2.Promise

```js
//  Promise ì¥ì  : callback í•¨ìˆ˜ì™€ ë¹„êµí•´ì„œ code ê°€ ì˜†ìœ¼ë¡œ ê¸¸ì–´ì§€ì§€ê°€ ì•ŠëŠ”ë‹¤
let first = new Promise(function (resolve, reject) { // resolve ëŠ” ì„±ê³µ, reject ëŠ” ì‹¤íŒ¨ í•œê²ƒì„ ë‚˜íƒ€ëƒ„
  resolve(); // resolve ê°€ ì‹¤í–‰ì´ ë˜ë©´ ë°‘ì— .then ì´ ì‹¤í–‰ì´ ë¨
  reject(); // reject ê°€ ì‹¤í–‰ì´ ë˜ë©´ ë°‘ì— .catch ê°€ ì‹¤í–‰ë¨
});

first.then(() => {
  // first ê°€ ì„±ê³µì¼ ê²½ìš° ì‹¤í–‰ í•  ì½”ë“œ
}).then(() => {
  // ê·¸ë‹¤ìŒì— ì‹¤í–‰í•  ê²ƒ
}).catch(() => {
  // catch ëŠ” ìœ„ì˜ ì½”ë“œê°€ ì‹¤íŒ¨ í–ˆì„ ê²½ìš° ì‹¤í–‰ í•˜ëŠ” code
})
```


### Promise ë¥¼ ì“°ëŠ” ì´ìœ 

- callback ëŒ€ì‹  ë³´ê¸° ì¢‹ì€ ì½”ë“œ

- ì„±ê³µ, ì‹¤íŒ¨ì˜ ê²½ìš°ì— ë§ì¶° ê°ê° ë‹¤ë¥¸ ì½”ë“œ ì‹¤í–‰ ê°€ëŠ¥í•¨



```js
// Promise ì˜ˆì‹œ 1.

let cal = new Promise(function (resolve, reject) {
  let sum = 1 + 1;
  resolve(sum); // ì„±ê³µí•œ ê²°ê³¼ë¥¼ return í•¨
  
})

cal.then(function (result) {
  console.log(result)
}).catch(function () {
  console.log('fail')
})
```

### Promise ì˜ 3ê°€ì§€ ìƒíƒœ

- ì„±ê³µí•˜ë©´ `<resolved>`

- íŒì • ëŒ€ê¸° ì¤‘ì´ë©´ `<pending>`

- ì‹¤íŒ¨í•˜ë©´ `<rejected>`


### Promise ì— ëŒ€í•œ ì˜¤í•´

- ë¹„ë™ê¸°ì  ì²˜ë¦¬ê°€ ê°€ëŠ¥í•˜ê²Œ ë°”ê¿”ì£¼ëŠ” ë¬¸ë²•ì´ ì•„ë‹™ë‹ˆë‹¤. (ë‹¨ì§€, callback í•¨ìˆ˜ëŒ€ì‹ í•´ì„œ ì“°ê¸°, ë³´ê¸° ì‰½ê²Œ ë§Œë“¤ì–´ì£¼ëŠ” ê²ƒì„)


### Promise ì—°ìŠµ

#### Q. <img> ì´ë¯¸ì§€ ë¡œë”© ì„±ê³µì‹œ íŠ¹ì • ì½”ë“œë¥¼ ì‹¤í–‰ í•˜ê¸°

- ì´ë¯¸ì§€ê°€ ë¡œë“œê°€ ë˜ë©´ ì½˜ì†” ì°½ì— ì„±ê³µ, ì‹¤íŒ¨ë¥¼ ì¶œë ¥í•¨

- Promise ë¥¼ ì‚¬ìš©í•´ì„œ then, catch í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ì„œ ë§Œë“¤ê¸°


```html
<!-- ì•„ë˜ì˜ ì´ë¯¸ì§€ì˜ ë¡œë“œê°€ ì„±ê³µí•˜ë©´ 'ì„±ê³µ ë©”ì‹œì§€', ì‹¤íŒ¨í•˜ë©´ 'ì‹¤íŒ¨ ë©”ì‹œì§€' -->
<img id="test" src="https://codingapple1.github.io/kona.jpg"> 
```

```js
const LoadImg = new Promise((resolve, reject) => { // Promise ê°ì²´ ìƒì„±
  const img = document.getElementById('test'); // img ë³€ìˆ˜ì— HTML id ì—°ê²°
  img.addEventListener('load', () => { // ë¡œë“œ ì„±ê³µì‹œ  resolve() ì‹¤í–‰
    resolve();
  });
  img.addEventListener('error', () => { // ë¡œë“œ ì‹¤íŒ¨ì‹œ reject() ì‹¤í–‰
    reject();
  });
});

LoadImg.then(() => { // ì„±ê³µì‹œ
  console.log('ì„±ê³µ');
}).catch(() => {  // ì‹¤íŒ¨ì‹œ
  console.log('ì‹¤íŒ¨'); 
})
```


## 3.async / await

- `ES8` ë¬¸ë²•ì— `Promise` ë¥¼ ëŒ€ì²´í• ` async / await` í‚¤ì›Œë“œë¥¼ í†µí•´ ì‰½ê²Œ Promise ê°ì²´ë¥¼ ìƒì„±í•˜ê³  `then`, `catch` ë¥¼ ëŒ€ì‹ í•´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- `async` ë¥¼ `function` ì•ì— ë¶™ì´ë©´ í•¨ìˆ˜ê°€ Promise ì—­í™œì„ í•˜ê²Œ ë˜ëŠ”ê²ƒì„

- ì¦‰, async ë¥¼ function ì•ì— ë¶™ì´ë©´ í•¨ìˆ˜ ì‹¤í–‰ í›„ì— Promise object ê°€ ë‚¨ê²Œ ë˜ëŠ” ê²ƒì…ë‹ˆë‹¤.


### async function ì•ˆì— ì“°ëŠ” await

- then ëŒ€ì‹ ì— ì‚¬ìš©ì´ ê°€ëŠ¥í•œ await

- ë‹¨ìˆœíˆ ì˜ë¯¸ëŠ” ê¸°ë‹¤ë ¤ ë‹¬ë¼ëŠ” ê²ƒì¸ë° ë¹„ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬ë¥¼ í• ë•Œ Promise ë¥¼ í•´ê²° í• ë•Œ ê¹Œì§€ ê¸°ë‹¤ë¦¬ë¼ëŠ” ì˜ë¯¸ ì…ë‹ˆë‹¤.

- ë‹¨! `await` ì€ `async` ì•ˆì—ì„œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í‚¤ì›Œë“œ ì…ë‹ˆë‹¤ 

- `await` ì€ `Promise` ê°€ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ê°€ ë‚˜ê³  ë©ˆì¶¥ë‹ˆë‹¤.

- ì‹¤íŒ¨ì‹œ ë©ˆì¶¤ì„ ë°©ì§€ í•˜ê³ ì `try{} catch{}` êµ¬ë¬¸ì„ ì‚¬ìš©í•©ë‹ˆë‹¤


### try{} catch{}

```js
async function cal() {
  let test = new Promise((resolve, reject) => {
    let sum = 1 + 1;
    resolve(sum);
  });

  try { //try ë¥¼ ë¨¼ì € ì‹¤í–‰í•´ë³´ê³  ì‹¤í–‰ë˜ë©´ try ë¬¸ ê·¸ëŒ€ë¡œ ì¶œë ¥
    let result = await test;
    console.log(result)
  } catch { // try ê°€ ì‹¤íŒ¨ì‹œ, catch ë¬¸ ì¶œë ¥
    console.log('fail')
  }
}

cal();
```

### async / await ì˜ˆì œ

- Q. `<button>` ì„ ëˆ„ë¥´ë©´ ì„±ê³µ íŒì • í•˜ëŠ” Promise & ì„±ê³µ ì‹œ 'ì„±ê³µí–ˆì–´ìš” ë¼ê³  ì¶œë ¥í•˜ê¸°'..

```html
<button id="btn">btn</button>
```

```js
async function cal() {
  const Btn = new Promise((resolve, reject) => {
    const button = document.getElementById('btn');
    button.addEventListener('click', () => {
      resolve('Pass');
    })
  });

  try {
    const result = await Btn;
    console.log(result);
  } catch {
    console.log('Fail')
  }
}


cal();
```

- ìˆœì°¨ì ìœ¼ë¡œ ë§ì€ ê²ƒì„ ì‹¤í–‰ í• ë•Œ ìœ ìš© í•©ë‹ˆë‹¤ (async / await)


ğŸ”¶ ğŸ”·  ğŸ“Œ ğŸ”‘

## Reference 

 - Rahul Sagore - [https://medium.com/@Rahulx1/understanding-event-loop-call-stack-event-job-queue-in-javascript-63dcd2c71ecd](https://medium.com/@Rahulx1/understanding-event-loop-call-stack-event-job-queue-in-javascript-63dcd2c71ecd){:target="\_blank"}  


- coding apple = [https://online.codingapple.com/course/javascript-es6/](https://online.codingapple.com/course/javascript-es6/){:target="\_blank"}  
